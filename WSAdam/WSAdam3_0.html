<!DOCTYPE html>
<html>
  <head>
    <title>ADAM-4050 3.0</title>
    <script type="text/javascript" src="jquery.js"></script>
    <script>
      var ws;
      var InLamp = new Array();
      for(var i=1;i<8;i++) InLamp[i] = '#DI' + (7-i) + '_c';

      $(document).ready(function(){
        var i=0;
        var html='ON<br>';

        for(i=0;i<8;i++)html+='<button type="button" onclick="DO_On(' + i +')">DO ' + i + '</button>'
        $('#OutONbutton').append(html);

        html='OFF<br>';

        for(i=0;i<8;i++)html+='<button type="button" onclick="DO_Off(' + i +')">DO ' + i + '</button>'
        $('#OutOFFbutton').append(html);

        html='<table><tr align="center">';

        for(i=0;i<7;i++)html+='<td><svg height="50" width="50"><circle id="DI' + i + '_c" cx="25" cy="25" r="20" stroke="black" fill="white"/></svg></td>';
        html+='</tr><tr align="center"><td>DI 0</td> <td>DI 1</td> <td>DI 2</td> <td>DI 3</td> <td>DI 4</td> <td>DI 5</td> <td>DI 6</td></tr></table>';
        $('#InputLamp').append(html);


        WebSocketConnect();
     });

    function WebSocketConnect(){
      try{
        ws=new WebSocket('ws://192.168.219.16:80/');

        ws.onopen=function(){ 
          status('Connected...');
          DI();
        }
        ws.onclose=function(){ status('Closed...'); }
        ws.onerror=function(evt){ status('Error ' + evt.data); }

        ws.onmessage=function(evt){
          for(var i=1;i<8;i++){
            if(evt.data[i] == '0') $(InLamp[i]).css("fill", "white");
            else $(InLamp[i]).css("fill", "red");
          }
        };
      }catch (exception){ status('Exception' + exception); }
    }

    function DO_On(chn){ ws.send('DO' + chn + '_ON'); }
    function DO_Off(chn){ ws.send('DO' + chn + '_OFF'); }
    function DI(){ ws.send("DI"); }

    function status(str){ $("#status").append(str); }

    </script>
  </head>

  <body>
    <p id="status">Connection Status:</p>
    <p id="OutONbutton"></p>
    <p id="OutOFFbutton"></p>
    <p id="InputLamp"></p>
  </body>

</html>
